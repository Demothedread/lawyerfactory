{
  "entities": [
    {
      "id": "workflow_phases",
      "type": "workflow",
      "name": "Sequential Lawsuit Workflow",
      "attributes": {
        "phases": [
          "intake",
          "planning",
          "research",
          "outline",
          "drafting",
          "editing",
          "criticism",
          "final_drafting",
          "post_production"
        ]
      }
    },
    {
      "id": "post_production_protocol",
      "type": "protocol",
      "name": "Court Packet Protocol",
      "attributes": {
        "default_court": "Superior Court of California",
        "deliverables": [
          "cover_sheet",
          "table_of_authorities",
          "supplemental_evidence_index",
          "manifest",
          "court_packet_zip"
        ]
      }
    },
    {
      "id": "court_packet_zip",
      "type": "artifact",
      "name": "Court Packet ZIP",
      "attributes": {
        "formats": [
          "pdf",
          "docx",
          "txt",
          "json"
        ],
        "location": "output/post_production/"
      }
    },
    {
      "id": "workflow.maestro_agent",
      "type": "component",
      "name": "Maestro orchestration agent",
      "path": "src/lawyerfactory/agents/orchestration/maestro.py",
      "notes": "Coordinates lawsuit workflow phases and storage integration."
    },
    {
      "id": "workflow.lawsuit_phase_sequence",
      "type": "workflow",
      "name": "Lawsuit phase sequence",
      "notes": "phaseA01_intake \u2192 phaseA02_research \u2192 phaseA03_outline \u2192 phaseB01_review \u2192 phaseB02_drafting \u2192 phaseC01_editing \u2192 phaseC02_orchestration"
    },
    {
      "id": "storage.enhanced_unified_storage_api",
      "type": "component",
      "name": "Enhanced unified storage API shim",
      "path": "src/lawyerfactory/storage/enhanced_unified_storage_api.py",
      "notes": "Compatibility re-export for unified storage API."
    },
    {
      "id": "cli_one_click_done_workflow",
      "type": "feature",
      "name": "CLI One-Click Done Case Packaging",
      "description": "Interactive CLI intake wizard that indexes an evidence folder and builds a ready-to-file PDF with cover sheet, statement of facts, table of authorities, and statement of claims."
    },
    {
      "id": "workflow.stage_blueprint",
      "type": "component",
      "name": "Stage-based lawsuit blueprint",
      "path": "src/lawyerfactory/compose/maestro/lawsuit_blueprint.py",
      "notes": "Defines discrete combinable phases from evidence/RAG ingestion through final compilation with a Head Partner role."
    },
    {
      "id": "workflow.document_object_map",
      "type": "component",
      "name": "Document object map",
      "path": "src/lawyerfactory/compose/maestro/document_object_map.py",
      "notes": "Tracks section-by-claim/theory links, overlap detection, and context-window compression packets."
    },
    {
      "id": "workflow.prewriting_packets",
      "type": "component",
      "name": "Pre-writing review packet generator",
      "path": "src/lawyerfactory/compose/maestro/prewriting_packets.py",
      "notes": "Builds three mandatory pre-writing deliverables for user review gate."
    }
  ],
  "features": [
    {
      "id": "phase_chain_manifest",
      "description": "Tracks upstream phase outputs and ties them to final deliverables."
    },
    {
      "id": "jurisdiction_defaulting",
      "description": "Defaults to Superior Court of California when jurisdiction is missing."
    },
    {
      "id": "tests.lawsuit_workflow_e2e",
      "type": "test",
      "name": "Lawsuit workflow E2E tests",
      "status": "added",
      "files": [
        "tests/e2e/test_lawsuit_workflow_e2e.py"
      ]
    },
    {
      "id": "evidence.tiered_classification",
      "type": "feature",
      "name": "Tiered evidence ingestion",
      "notes": "Adds primary/secondary/tertiary evidence tiers with tagging for source indexing."
    },
    {
      "id": "cli_one_click_done",
      "module": "apps.cli.one_click_case_builder",
      "capabilities": [
        "evidence_folder_selection",
        "intake_qna",
        "intake_file_or_direct",
        "pdf_case_package_output"
      ]
    },
    {
      "id": "workflow.evidence_cycle_payload",
      "type": "feature",
      "name": "Evidence cycle payload builder",
      "notes": "Builds iterative primary/secondary/tertiary evidence buckets for repeated ingest and categorization loops."
    },
    {
      "id": "workflow.context_window_packet",
      "type": "feature",
      "name": "Context-window-safe document packet",
      "notes": "Compresses section summaries under token budget and preserves section location metadata."
    },
    {
      "id": "workflow.prewriting_user_gate",
      "type": "feature",
      "name": "Three deliverable pre-writing gate",
      "notes": "Evidence reliability brief, issue-fact matrix, and claim-theory strategy sheet must be reviewed before drafting."
    },
    {
      "id": "workflow.debug_observability",
      "type": "feature",
      "name": "Detailed orchestration debug logging",
      "notes": "Adds structured logs for blueprint generation, evidence cycle construction, pre-writing packet serialization, and document-map overlap/context-packet builds."
    }
  ],
  "relations": [
    {
      "from": "workflow_phases",
      "to": "post_production_protocol",
      "type": "culminates_in",
      "notes": "Post-production consumes outputs from all prior phases."
    },
    {
      "from": "post_production_protocol",
      "to": "court_packet_zip",
      "type": "produces"
    },
    {
      "source": "tests.lawsuit_workflow_e2e",
      "type": "validates",
      "target": "workflow.lawsuit_phase_sequence"
    },
    {
      "source": "workflow.maestro_agent",
      "type": "implements",
      "target": "workflow.lawsuit_phase_sequence"
    },
    {
      "source": "workflow.maestro_agent",
      "type": "depends_on",
      "target": "storage.enhanced_unified_storage_api"
    },
    {
      "from": "cli_one_click_done_workflow",
      "to": "post_production_pdf_generator",
      "type": "uses"
    },
    {
      "source": "workflow.maestro_agent",
      "type": "exposes",
      "target": "workflow.stage_blueprint"
    },
    {
      "source": "workflow.stage_blueprint",
      "type": "extends",
      "target": "evidence.tiered_classification"
    },
    {
      "source": "workflow.maestro_agent",
      "type": "exposes",
      "target": "workflow.document_object_map"
    },
    {
      "source": "workflow.maestro_agent",
      "type": "exposes",
      "target": "workflow.prewriting_packets"
    },
    {
      "source": "workflow.document_object_map",
      "type": "supports",
      "target": "workflow.context_window_packet"
    },
    {
      "source": "workflow.prewriting_packets",
      "type": "implements",
      "target": "workflow.prewriting_user_gate"
    },
    {
      "source": "workflow.maestro_agent",
      "type": "observes",
      "target": "workflow.debug_observability"
    }
  ],
  "notes": [
    {
      "id": "issue.phase_id_mismatch",
      "text": "Workflow start now aligns current_phase to phase_sequence[0] to avoid mismatched phase IDs."
    },
    {
      "id": "issue.storage_shim_missing",
      "text": "Added a storage shim to satisfy imports of storage.enhanced_unified_storage_api."
    },
    {
      "id": "note.lint_backlog",
      "text": "Repo-wide Ruff linting fails due to legacy violations; limiting lint scope or remediating existing files is required for a clean run."
    },
    {
      "id": "note.cli_one_click_done",
      "text": "One-click CLI flow supports direct intake statements or file-based intake narratives for plaintiff/defendant venue-jurisdiction guided prompts."
    },
    {
      "id": "note.stage_blueprint_scope",
      "text": "Blueprint enforces phase order: evidence+RAG -> issue spot -> analysis -> fact lists -> causes of action -> top sheet -> compile."
    },
    {
      "id": "note.claim_section_linking",
      "text": "Sections are now mapped by underlying claim_id and theory_id to prevent overlap/repetition and preserve modular assembly."
    },
    {
      "id": "note.logging_scope_modular_workflow",
      "text": "Logging now emits counts, IDs, token budget usage, and overlap indicators to accelerate troubleshooting of modular long-form workflow stages."
    }
  ],
  "updates": [
    {
      "timestamp": "2025-02-14T00:00:00Z",
      "summary": "Added lawsuit workflow E2E tests, storage shim, and documented phase transition alignment."
    },
    {
      "timestamp": "2025-02-14T01:00:00Z",
      "summary": "Documented lint backlog note and current test coverage scope."
    },
    {
      "timestamp": "2025-02-14T02:00:00Z",
      "summary": "Captured tiered evidence ingestion for primary, secondary, and tertiary evidence tagging."
    },
    {
      "timestamp": "2026-02-28T03:16:34Z",
      "summary": "Added CLI one-click done workflow for evidence-folder-driven intake and ready-to-file PDF package generation."
    },
    {
      "timestamp": "2026-02-27T00:00:00Z",
      "summary": "Added modular lawsuit stage blueprint, maestro accessors, and unit tests for evidence cycling + phase order."
    },
    {
      "timestamp": "2026-02-27T01:00:00Z",
      "summary": "Added document object map compression/linking and three pre-writing deliverables with maestro accessors and unit tests."
    },
    {
      "timestamp": "2026-02-27T02:00:00Z",
      "summary": "Instrumented modular workflow components with structured debugging logs for stage blueprint, evidence cycles, pre-writing packets, and document object map packets."
    }
  ]
}